---
title: "Covid"
author: "Alexis Cavero Arocas, Eric Villaescusa Topper, Alberto Dalmau Garcia, Marcos Baudson Rios"
date: "2024-03-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r}

library(dplyr)
library(zoo)
library(ggplot2)
library(readr)
library(plotly)# Asegúrate de cargar readr para leer el CSV

# Leer los datos
covid_data <- read_csv("data/owid-covid-data.csv")

# Procesar los datos
filtered_data <- covid_data %>%
  filter(location %in% c("United States", "Italy", "France", "Germany", "Canada", "Japan", "United Kingdom", "Spain")) %>%
  group_by(location) %>%
  mutate(deaths_per_million_7day_avg = rollmean(new_deaths_smoothed_per_million, 7, fill = NA, align = 'right'))  # Asegúrate de que el nombre de la columna sea correcto

fechas_especificas <- as.Date(c("2020-02-13", "2020-08-08", "2021-02-24", "2021-08-08", "2022-02-28", "2022-08-08", "2023-02-28", "2023-08-18", "2024-02-10"))

# Crear el gráfico
plot <- ggplot(filtered_data, aes(x = date, y = deaths_per_million_7day_avg, color = location, group = location)) +
  geom_line(aes(size = location == 'Spain')) + scale_size_manual(values = c("TRUE" = 1, "FALSE" = 0.5)) + 
  scale_color_manual(values = c("United States" = "purple", "Italy" = "blue", "France" = "orange", 
                                "Germany" = "green", "Canada" = "brown", "Japan" = "grey", 
                                "United Kingdom" = "pink", "Spain" = "red")) +
   scale_x_date(breaks = fechas_especificas, date_labels = "%d %b %Y") + theme_minimal() +
  labs(title = "Daily new confirmed COVID-19 deaths per million people (7-day rolling average)", 
       subtitle = "For some countries the number of confirmed deaths is much lower than the true number of deaths.",
       caption = "Source: Johns Hopkins University CSSE COVID-19 Data", x = "", y = "") +
 theme(legend.title = element_blank(),
        axis.text.x = element_text(angle = 0, hjust = 0.5, vjust = 0, size = 15, face = "bold"),
        axis.text.y = element_text(angle = 0, hjust = 1, size = 18, face = "bold"),
        legend.text = element_text(size = 16), # Aumentar tamaño del texto de la leyenda
        legend.key.size = unit(1.5, 'lines'),
        plot.title = element_text(size = 24, face = "bold"), # Aumentar tamaño y cambiar fuente
        plot.subtitle = element_text(size = 18), # Aumentar tamaño y cambiar fuente
        plot.caption = element_text(hjust = 0, vjust = 0, size = 12, face = "bold", color = "black"))

#Modificamos la leyenda
plot <- plot + guides(size = FALSE)

ggplotly(plot)

#Guardamos el gráfico en PDF
ggsave("GraficoTema3.pdf", plot = plot, width = 16, height = 8, dpi = 1000)


```

